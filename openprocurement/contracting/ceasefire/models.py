# -*- coding: utf-8 -*-
from schematics.transforms import whitelist
from schematics.types import StringType
from zope.interface import implementer, Interface

from openprocurement.api.models.schematics_extender import (
    IsoDateTimeType,
    Model,
)
from openprocurement.contracting.core.models import (
    Contract as BaseContract,
    contract_create_role,
    contract_view_role,
)
from openprocurement.contracting.ceasefire import constants 


class ICeasefireContract(Interface):
    """Contract marker interface
    """


@implementer(ICeasefireontract)
class Contract(BaseContract):
    """Common Contract
    """

    class Options:
        roles = {
            'create': contract_create_role + whitelist('contractType'),
            'view': contract_view_role + whitelist('contractType'),
        }
    status = StringType(choices=constants.CONTRACT_STATUSES)
    # must be generated by databridge
    contractType = StringType(required=False, choices=['ceasefire'])


class Milestone(Model):
    """Contract milestone
    """
    id = MD5Type(required=True, default=lambda: uuid4().hex)
    dateMet = IsoDateTimeType()
    dateModified = IsoDateTimeType()
    description = StringType()
    dueDate = IsoDateTimeType()
    status = StringType(choices=constants.MILESTONE_STATUSES)
    title = StringType()
    type = StringType(choices=constants.MILESTONE_TYPES)
